<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Java çˆ¬è™«æ¡†æ¶ WebMagic - ACodingDayBlog</title>
<link rel="shortcut icon" href="https://ACodingDay.github.io/favicon.ico">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css">
<link rel="stylesheet" href="https://ACodingDay.github.io/media/css/tailwind.css">
<link rel="stylesheet" href="https://ACodingDay.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="Java çˆ¬è™«æ¡†æ¶ WebMagic - ACodingDayBlog - Atom Feed" href="https://ACodingDay.github.io/atom.xml">

    

  <meta name="description" content="å‰è¨€
ç½‘ä¸Šå†²æµªğŸ‚ï¼Œç»å¸¸ä¼šé‡åˆ°æƒ³è¦æ‰¹é‡ä¿å­˜çš„æ²™é›•è¡¨æƒ…åŒ…ã€Coser å¥—å›¾ã€äºŒæ¬¡å…ƒå›¾ç‰‡ç­‰ç´ æèµ„æº......é‚£ä»€ä¹ˆèƒ½å®ç°å¿«æ·æœ‰æ•ˆçš„æ‰¹é‡ä¸‹è½½å‘¢ï¼Ÿçˆ¬è™«ç¨‹åºã€‚
è¯´èµ·çˆ¬è™«ï¼Œæˆ‘çš„ç¬¬ä¸€ååº”å°±æ˜¯ Python è¯­è¨€ï¼Œç„¶åæƒ³åˆ°å®ƒçš„ç›¸å…³å·¥å…·ï¼šScrapyã€Se..." />
  <meta property="og:title" content="Java çˆ¬è™«æ¡†æ¶ WebMagic - ACodingDayBlog">
  <meta property="og:description" content="å‰è¨€
ç½‘ä¸Šå†²æµªğŸ‚ï¼Œç»å¸¸ä¼šé‡åˆ°æƒ³è¦æ‰¹é‡ä¿å­˜çš„æ²™é›•è¡¨æƒ…åŒ…ã€Coser å¥—å›¾ã€äºŒæ¬¡å…ƒå›¾ç‰‡ç­‰ç´ æèµ„æº......é‚£ä»€ä¹ˆèƒ½å®ç°å¿«æ·æœ‰æ•ˆçš„æ‰¹é‡ä¸‹è½½å‘¢ï¼Ÿçˆ¬è™«ç¨‹åºã€‚
è¯´èµ·çˆ¬è™«ï¼Œæˆ‘çš„ç¬¬ä¸€ååº”å°±æ˜¯ Python è¯­è¨€ï¼Œç„¶åæƒ³åˆ°å®ƒçš„ç›¸å…³å·¥å…·ï¼šScrapyã€Se..." />
  <meta property="og:type" content="articles">
  <meta property="og:url" content="https://ACodingDay.github.io/post/5/" />
  <meta property="og:image" content="https://mytc2020-1300758689.cos.ap-guangzhou.myqcloud.com/Gridea/post5.jpg">
  <meta property="og:image:height" content="630">
  <meta property="og:image:width" content="1200">
  <meta name="twitter:title" content="Java çˆ¬è™«æ¡†æ¶ WebMagic - ACodingDayBlog">
  <meta name="twitter:description" content="å‰è¨€
ç½‘ä¸Šå†²æµªğŸ‚ï¼Œç»å¸¸ä¼šé‡åˆ°æƒ³è¦æ‰¹é‡ä¿å­˜çš„æ²™é›•è¡¨æƒ…åŒ…ã€Coser å¥—å›¾ã€äºŒæ¬¡å…ƒå›¾ç‰‡ç­‰ç´ æèµ„æº......é‚£ä»€ä¹ˆèƒ½å®ç°å¿«æ·æœ‰æ•ˆçš„æ‰¹é‡ä¸‹è½½å‘¢ï¼Ÿçˆ¬è™«ç¨‹åºã€‚
è¯´èµ·çˆ¬è™«ï¼Œæˆ‘çš„ç¬¬ä¸€ååº”å°±æ˜¯ Python è¯­è¨€ï¼Œç„¶åæƒ³åˆ°å®ƒçš„ç›¸å…³å·¥å…·ï¼šScrapyã€Se...">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="canonical" href="https://ACodingDay.github.io/post/5/">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
 
  
    <link rel="stylesheet" href="https://ACodingDay.github.io/media/css/prism-atom-dark.css">
  

  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
  
</head>

<body>
  <div class="antialiased flex flex-col min-h-screen" id="app">
    <a href="https://ACodingDay.github.io" class="fixed top-0 left-0 mt-4 bg-black text-white dark:text-gray-700 dark:bg-yellow-50 dark:hover:bg-black dark:hover:text-white inline-flex p-2 pl-8 hover:text-gray-700 hover:bg-yellow-50 font-bold z-10 transition-fast animated fadeInLeft">
      ACodingDayBlog
    </a>
    <div class="max-w-4xl w-full mx-auto">
      <div class="shadow-box bg-white dark:bg-gray-600 rounded-lg pt-32 md:pt-64 px-4 md:px-8 pb-8 animated fadeIn mb-8">
        <h1 class="text-5xl font-semibold leading-normal pb-8 mb-8 border-b-8 border-gray-700">
          Java çˆ¬è™«æ¡†æ¶ WebMagic
        </h1>
        
          <img src="https://mytc2020-1300758689.cos.ap-guangzhou.myqcloud.com/Gridea/post5.jpg" alt="Java çˆ¬è™«æ¡†æ¶ WebMagic" class="block w-full mb-8">
        
        <div class="mb-8 flex flex-wrap">
          <div class="text-gray-400 text-sm mr-4">2021-12-24 Â· 8 min read</div>
          
            <a href="https://ACodingDay.github.io/tag/RiLx-KYXT/" class="text-gray-700 text-sm border-b-2 border-dotted border-gray-200 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
              <i class="ri-hashtag"></i>
              çˆ¬è™«
            </a>
          
            <a href="https://ACodingDay.github.io/tag/oAJNj9S4fb/" class="text-gray-700 text-sm border-b-2 border-dotted border-gray-200 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
              <i class="ri-hashtag"></i>
              Java
            </a>
          
            <a href="https://ACodingDay.github.io/tag/qxPU34ijR/" class="text-gray-700 text-sm border-b-2 border-dotted border-gray-200 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
              <i class="ri-hashtag"></i>
              æŠ˜è…¾
            </a>
          
            <a href="https://ACodingDay.github.io/tag/k5iAkZuWD/" class="text-gray-700 text-sm border-b-2 border-dotted border-gray-200 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
              <i class="ri-hashtag"></i>
              çŠ¶æ€ç 
            </a>
          
        </div>
        <div class="markdown mb-8" v-pre>
          <h2 id="å‰è¨€">å‰è¨€</h2>
<p>ç½‘ä¸Šå†²æµªğŸ‚ï¼Œç»å¸¸ä¼šé‡åˆ°æƒ³è¦æ‰¹é‡ä¿å­˜çš„æ²™é›•è¡¨æƒ…åŒ…ã€Coser å¥—å›¾ã€äºŒæ¬¡å…ƒå›¾ç‰‡ç­‰ç´ æèµ„æº......é‚£ä»€ä¹ˆèƒ½å®ç°å¿«æ·æœ‰æ•ˆçš„æ‰¹é‡ä¸‹è½½å‘¢ï¼Ÿçˆ¬è™«ç¨‹åºã€‚<br>
è¯´èµ·çˆ¬è™«ï¼Œæˆ‘çš„ç¬¬ä¸€ååº”å°±æ˜¯ <code>Python</code> è¯­è¨€ï¼Œç„¶åæƒ³åˆ°å®ƒçš„ç›¸å…³å·¥å…·ï¼šScrapyã€Selenium......ä½†æ˜¯æˆ‘æ²¡æœ‰ç³»ç»Ÿå­¦ä¹ è¿‡ <code>Python</code>ï¼ˆ<s>å­¦è¿‡ä¸€ç‚¹çš®æ¯›</s>ï¼‰ï¼Œè€Œä¸”å¯¹å®ƒä¹Ÿä¸æ€ä¹ˆæ„Ÿå…´è¶£å•ŠğŸ˜Ÿã€‚</p>
<h2 id="æ’ä»¶-å›¾ç‰‡åŠ©æ‰‹">æ’ä»¶ â€” å›¾ç‰‡åŠ©æ‰‹</h2>
<p>å¯¹äºä¸ä¼š <code>Python</code> çˆ¬è™«çš„æˆ‘ï¼Œéš¾ä¸æˆåªèƒ½é é¼ æ ‡åœ¨ç›®æ ‡ç½‘é¡µä¸Šç‚¹å‡»å³é”® -&gt; â€œå°†å›¾åƒå¦å­˜ä¸ºâ€ï¼Ÿæ•ˆç‡ä½ä¸‹ã€‚<br>
å¹¸å¥½æˆ‘æ‰¾åˆ°äº†ä¸€æ¬¾ä¼˜ç§€çš„æµè§ˆå™¨æ‰©å±•æ’ä»¶â€”â€”<a href="https://chrome.google.com/webstore/detail/imageassistant-batch-imag/dbjbempljhcmhlfpfacalomonjpalpko?hl=zh-CN">å›¾ç‰‡åŠ©æ‰‹</a>ï¼Œå•†åº—ä¸­æ˜¾ç¤ºå®ƒçš„ç”¨æˆ·é«˜è¾¾ 30W+ï¼Œè€Œä¸”è¯„åˆ†ä¸ä½ï¼<br>
<img src="https://mytc2020-1300758689.cos.ap-guangzhou.myqcloud.com/Gridea/ImageAssistant.png" alt="ImageAssistant" loading="lazy"><br>
ç®€å•æ¥è¯´ï¼Œå®ƒå¯ä»¥å¿«é€Ÿæå–ç½‘é¡µå›¾ç‰‡å¹¶æ‰¹é‡ä¸‹è½½ï¼Œæ ‡ç­¾é¡µä¸­å°†æ•´ä¸ªé¡µé¢çš„å›¾ç‰‡éƒ½ä»¥ç¼©ç•¥å›¾çš„å½¢å¼å±•ç¤ºå‡ºæ¥ï¼Œå¹¶ä¸”å¯ä»¥å¯¹ç¼©ç•¥å›¾æ·»åŠ ç­›é€‰æ¡ä»¶ï¼ˆè¿‡æ»¤ä¸€äº›å°ºå¯¸è¾ƒå°çš„å›¾ç‰‡ï¼‰ã€‚<br>
ä½¿ç”¨çš„æ–¹æ³•å¾ˆç®€å•ï¼Œå¯ç”¨åï¼Œåœ¨ç›®æ ‡ç½‘é¡µä¸Šç‚¹å‡»æ‰©å±•çš„â€œæå–ç½‘é¡µå›¾ç‰‡â€åŠŸèƒ½å³å¯ã€‚<br>
<img src="https://mytc2020-1300758689.cos.ap-guangzhou.myqcloud.com/Gridea/ImageAssistantFun.png" alt="ä½¿ç”¨ç®€å•" loading="lazy"><br>
ä»¥å“”å“©å“”å“©é¦–é¡µä¸ºä¾‹ï¼Œæå–åå¯ä»¥çœ‹åˆ°å›¾ç‰‡çš„æ ¼å¼ç±»å‹ã€åˆ†è¾¨ç‡å¤§å°ã€ç­›é€‰æ¡ä»¶ç­‰è®¾ç½®ï¼Œç‚¹å‡»é€‰ä¸­ä¸‹è½½å³å¯ã€‚<br>
<img src="https://mytc2020-1300758689.cos.ap-guangzhou.myqcloud.com/Gridea/IAExtractPic.png" alt="æå–å›¾ç‰‡ç»“æœ" loading="lazy"></p>
<h2 id="æ¡†æ¶-webmagic">æ¡†æ¶ â€” WebMagic</h2>
<p>æ—¢ç„¶æˆ‘ä¸ä¼š <code>Python</code> çš„çˆ¬è™«ï¼Œé‚£å°±é€‰ <code>Java</code> çš„å§ï¼ˆ<s>å¤§èªæ˜</s>ï¼‰ã€‚<br>
<a href="https://github.com/code4craft/webmagic"><code>WebMagic</code></a> æ˜¯ä¸€ä¸ªç®€å•çµæ´»çš„ Java çˆ¬è™«æ¡†æ¶ï¼Œå®˜æ–¹ä¸­æ–‡æ–‡æ¡£ï¼š<a href="http://webmagic.io/docs/zh/">WebMagic in Action</a>ã€‚</p>
<h3 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–</h3>
<p>ä½¿ç”¨ <code>Maven</code> æ¥å®‰è£… <code>WebMagic</code>ï¼Œåœ¨ <code>Spring Boot</code> é¡¹ç›®ä¸­å¼•å…¥ã€‚</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;us.codecraft&lt;/groupId&gt;
    &lt;artifactId&gt;webmagic-core&lt;/artifactId&gt;
    &lt;version&gt;0.7.5&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;us.codecraft&lt;/groupId&gt;
    &lt;artifactId&gt;webmagic-extension&lt;/artifactId&gt;
    &lt;version&gt;0.7.5&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h3 id="ç›®æ ‡ç½‘ç«™">ç›®æ ‡ç½‘ç«™</h3>
<p>ä½œä¸ºä¸€ä¸ª SPï¼ˆæˆ‘ä¸è€ï¼‰ï¼Œçˆ¬å–çš„ç½‘ç«™ä¸€èˆ¬éƒ½æ˜¯é‚£äº›å†™çœŸå¥—å›¾ç½‘ç«™ï¼Œä¾‹å¦‚ï¼š<a href="https://mmzztt.com/">ç¾ä¹‹å›¾</a>ã€‚<br>
ä¾‹è¡Œåˆ†æè¿™ä¸ªç½‘ç«™ï¼Œæ¯æ¬¡æŒ‰ <code>F12</code> æ‰“å¼€æµè§ˆå™¨çš„æ§åˆ¶å°ï¼Œéƒ½æ˜¾ç¤ºä¸€ä¸ªâ€œ<code>å·²åœ¨è°ƒè¯•ç¨‹åºä¸­æš‚åœ</code>â€çš„æç¤ºï¼Œè¿™ä¸ªæœ‰ç‚¹ç¢çœ¼ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³ã€‚</p>
<ol>
<li>æ¯æ¬¡éƒ½è¦é‡å¤æ­¥éª¤ï¼šå…ˆç‚¹å‡»â€œåœç”¨æ–­ç‚¹â€ï¼ˆ<code>Ctrl</code> + <code>F8</code>ï¼‰ï¼Œå†ç‚¹å‡»â€œå‰è¿›â€ï¼ˆ<code>F8</code>ï¼‰ã€‚<br>
<img src="https://mytc2020-1300758689.cos.ap-guangzhou.myqcloud.com/Gridea/pauseStep1.png" alt="é‡å¤æ­¥éª¤" loading="lazy"></li>
<li>è¿™ç§è®¾ç½®ä¸€åŠ³æ°¸é€¸ï¼Œä½†è¦è®°å¾—åœ¨éœ€è¦çš„æ—¶å€™å–æ¶ˆã€‚<br>
<img src="https://mytc2020-1300758689.cos.ap-guangzhou.myqcloud.com/Gridea/pauseStep2.png" alt="ä¸€æ¬¡è®¾ç½®" loading="lazy"></li>
</ol>
<p>ç‚¹å‡»â€œå†™çœŸé¦†â€ï¼Œè¿›å…¥â€œhttps://mmzztt.com/photo/â€ï¼Œç‚¹å‡»â€œæ£€æŸ¥å…ƒç´ â€ï¼Œå¼€å§‹å¯»æ‰¾è§„å¾‹ã€‚<br>
<img src="https://mytc2020-1300758689.cos.ap-guangzhou.myqcloud.com/Gridea/checkPicStep1.png" alt="æŸ¥æ‰¾è§„å¾‹" loading="lazy"></p>
<h3 id="åˆ†æè§„å¾‹">åˆ†æè§„å¾‹</h3>
<p>æŸ¥çœ‹å¤šå¼ å°é¢å›¾çš„ <code>src</code> å±æ€§åï¼Œå°±å¯ä»¥å¾—çŸ¥é“¾æ¥éƒ½æ˜¯å¦‚ä¸‹çš„å½¢å¼ï¼š</p>
<ul>
<li>https://t.iimzt.com/thumb/51490/960.jpg</li>
<li>https://t.iimzt.com/thumb/51322/960.jpg</li>
<li>https://t.iimzt.com/thumb/51400/960.jpg</li>
<li>https://t.iimzt.com/thumb/51249/960.jpg</li>
<li>https://t.iimzt.com/thumb/51156/960.jpg</li>
</ul>
<p><strong>åŸŸååœ°å€å°±ä¸ç”¨è¯´äº†ï¼Œå°é¢å›¾çš„æ–‡ä»¶åéƒ½æ˜¯ <code>960.jpg</code>ï¼Œè€Œå˜çš„åªæ˜¯ <code>thumb</code> åé¢çš„å‚æ•°ï¼Œè¿™ä¸ªå˜åŒ–çš„å‚æ•°å°±æ˜¯å¯¹åº”çš„ä¸“è¾‘ã€‚</strong><br>
ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨â€œhttps://mmzztt.com/photo/â€ååŠ ä¸Šå¯¹åº”çš„ä¸“è¾‘æ•°å­—ï¼Œå°±å¯ä»¥è¿›å…¥å¯¹åº”çš„ä¸“è¾‘å¥—å›¾ä¸­å»ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œç‚¹å‡»â€œhttps://mmzztt.com/photo/51490â€å°±ä¼šè¿›å…¥ä¸“è¾‘çš„å†…å®¹é¡µé¢ï¼Œè€Œè¿™ä¸ªæ•°å­—â€œ51490â€å¯ä»¥ä»å°é¢å›¾ä¸­è·å–ã€‚</p>
<p>é—æ†¾çš„æ˜¯ï¼Œå¹¶ä¸èƒ½ç›´æ¥çœ‹å‡ºå…·ä½“å›¾ç‰‡çš„å‘½åæ–¹å¼ï¼Œå› ä¸ºä¸å¯èƒ½é‡‡å–ä»â€œ960.jpgâ€é€’å‡åˆ°â€œ001.jpgâ€è¿™ä¹ˆç›´ç™½æœ´ç´ ï¼ˆ<s>æ„šè ¢</s>ï¼‰çš„å‘½åæ–¹æ¡ˆã€‚<br>
ç‚¹å‡»è¿›å…¥ä¸“è¾‘â€œ51490â€ï¼Œç»§ç»­æ£€æŸ¥å›¾ç‰‡çš„æ¥æºï¼Œåˆ†æè§„å¾‹ï¼š</p>
<ul>
<li>ç¬¬ 1 å¼ ï¼šhttps://p.iimzt.com/2021/12/13b01i.jpg</li>
<li>ç¬¬ 2 å¼ ï¼šhttps://p.iimzt.com/2021/12/13b02e.jpg</li>
<li>ç¬¬ 3 å¼ ï¼šhttps://p.iimzt.com/2021/12/13b03d.jpg</li>
<li>çœç•¥......</li>
<li>ç¬¬ 13 å¼ ï¼šhttps://p.iimzt.com/2021/12/13b13e.jpg</li>
</ul>
<p>ä»è¿™ä¸ªèƒ½çœ‹å‡ºæ¥ï¼šå‰é¢çš„åŸŸååœ°å€ä¸å˜ï¼Œä¸­é—´æ˜¯å˜åŒ–çš„æœ‰è§„å¾‹çš„æ—¥æœŸæ ¼å¼â€”â€”â€œ2021/12/13â€ï¼Œåé¢çš„æ˜¯å˜åŒ–çš„å›¾ç‰‡å‘½åâ€”â€”å¯èƒ½å›ºå®šçš„é¦–å­—æ¯ + â€œå½“å‰çš„å›¾ç‰‡æ•°ï¼ˆç¬¬ X å¼ ï¼‰â€ + éšæœºçš„æœ«å­—æ¯ã€‚<br>
ä¸€å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯é¦–å­—æ¯å›ºå®šæ˜¯ <code>b</code>ï¼Œç›´åˆ°å¦ä¸€å¥—æ˜¯é¦–å­—æ¯æ˜¯ <code>a</code>ï¼Œä½†éšæœºåˆçœ‹äº†åå‡ å¥—ï¼ŒåŸºæœ¬éƒ½æ˜¯é¦–å­—æ¯ <code>a</code> æˆ– <code>b</code>ï¼Œè¿˜æ²¡çœ‹åˆ°é¦–å­—æ¯ä¸º <code>c</code> çš„ï¼ˆå¯èƒ½æ˜¯æˆ‘æ²¡å‘ç°ï¼Œæˆ–è€…å°±æ˜¯æ²¡æœ‰ï¼‰ã€‚<br>
é¦–æœ«çš„éšæœºå­—æ¯æ˜¯ä¸æ˜¯æœ‰æŸç§å¯¹åº”çš„è§„å¾‹ï¼ˆç®—æ³•ç”Ÿæˆï¼‰ï¼Œæš‚æ—¶çœ‹ä¸å‡ºæ¥ï¼Œæœ‰å¯èƒ½æ˜¯çœŸçš„éšæœºâ€”â€”å¤–å±‚å¾ªç¯éšæœºä½¿ç”¨å­—æ¯ <code>a</code> æˆ– <code>b</code>ï¼Œå†…å±‚å¾ªç¯ä»å­—æ¯ <code>a</code> åˆ°å­—æ¯ <code>z</code> éšæœºæŒ‘é€‰ã€‚</p>
<blockquote>
<p>å½“æˆ‘è¿ç»­ç‚¹å‡»å¥—å›¾çš„â€œä¸‹ä¸€å¼ â€ï¼Œåˆ°ç¬¬ 16 å¼ æ—¶ï¼Œç½‘ç«™å°±ä¼šè‡ªåŠ¨è·³è½¬åˆ°ä¸‹è½½ APP çš„é¡µé¢ã€‚åæ¥è¿™ä¸ªç°è±¡åˆæ²¡äº†ã€‚</p>
</blockquote>
<h3 id="å®ç°-pageprocessor">å®ç° PageProcessor</h3>
<p>æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„è¯´æ˜ï¼Œ<code>PageProcessor</code> çš„å®šåˆ¶åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯çˆ¬è™«çš„é…ç½®ã€é¡µé¢å…ƒç´ çš„æŠ½å–å’Œé“¾æ¥çš„å‘ç°ã€‚<br>
é’ˆå¯¹â€œå†™çœŸé¦†â€ç•Œé¢çš„å¥—å›¾è¿›è¡ŒæŠ½å–å…ƒç´ ï¼Œè¿™éƒ¨åˆ†éœ€è¦æ‡‚ä¸€ç‚¹ XPath è§„åˆ™ä»¥åŠæ­£åˆ™è¡¨è¾¾å¼ã€‚<br>
ä¸ºäº†ç®€å•èµ·è§ï¼Œç›´æ¥æŠ½å–å¥—å›¾ä¸“è¾‘çš„æ–‡å­—æ ‡é¢˜ä»¥åŠé¦–é¡µå›¾çš„é“¾æ¥ã€‚</p>
<pre><code>@Override
    public void process(Page page) {
        // åˆ—è¡¨é¡µ
        if (page.getUrl().regex(URL_LIST).match()) {
            /**
             * è¿è¡Œæ—¶æŠ›å‡ºå¼‚å¸¸ï¼šLinks can not apply to plain text.
             * Please check whether you use a previous xpath with attribute select (/@href etc).
             * åŸå› ï¼šä½¿ç”¨è¿‡æ­£åˆ™åŒ¹é…åå°±ä¸èƒ½ä½¿ç”¨ XPath æŠ½å–äº†ï¼Œå› ä¸ºæ­£åˆ™å–å‡ºæ¥çš„æ²¡æœ‰åŠæ³•ä¿è¯æ˜¯ Htmlï¼Œå½“åšæ˜¯æ˜¯çº¯æ–‡æœ¬å¤„ç†äº†
             */
            page.addTargetRequests(page.getHtml().xpath(&quot;//a[@class='uk-inline']/@href&quot;).regex(URL_ARTICLE).all());
            page.addTargetRequests(page.getHtml().links().regex(URL_LIST).all());
        } else {
            // æ ‡é¢˜å
            String imgTitle = page.getHtml().xpath(&quot;//h1[@class='uk-article-title uk-text-truncate']/text()&quot;).toString();
            // å¥—å›¾ç¬¬ä¸€å¼ çš„é“¾æ¥
            String imgUrl = page.getHtml().xpath(&quot;//figure[@class='uk-inline']/img/@src&quot;).toString();
            MztImage image = new MztImage();
            image.setId(counter.get());
            atomicAdd();
            image.setName(imgTitle);
            image.setAvatar(imgUrl);
            page.putField(&quot;result&quot;, image);
        }
    }
</code></pre>
<h3 id="è‡ªå®šä¹‰-pipeline">è‡ªå®šä¹‰ Pipeline</h3>
<p><code>Pipeline</code>å…¶å®å°±æ˜¯å°† <code>PageProcessor</code> æŠ½å–çš„ç»“æœï¼Œç»§ç»­è¿›è¡Œäº†å¤„ç†ï¼Œä¸»è¦ç”¨äºæŠ½å–ç»“æœçš„ä¿å­˜ã€‚WebMagic ä¸­å·²ç»æä¾›äº†å°†ç»“æœè¾“å‡ºåˆ°æ§åˆ¶å°ã€ä¿å­˜åˆ°æ–‡ä»¶å’Œ JSON æ ¼å¼ä¿å­˜çš„å‡ ä¸ª Pipeline ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ Pileline å®ç°æƒ³è¦çš„åŠŸèƒ½ã€‚<br>
è‡ªå®šä¹‰å®ç°ï¼šå°†æ–‡å­—æ ‡é¢˜ä½œä¸º TXT æ–‡æœ¬æ–‡ä»¶çš„æ–‡ä»¶åï¼Œé¦–é¡µå›¾é“¾æ¥ä½œä¸ºæ–‡æœ¬ä¸­çš„å†…å®¹ã€‚</p>
<pre><code>import com.example.common.MztImage;
import com.example.tool.HttpFileTool;
import us.codecraft.webmagic.ResultItems;
import us.codecraft.webmagic.Task;
import us.codecraft.webmagic.pipeline.Pipeline;

import java.io.File;
import java.io.FileWriter;
import java.io.Writer;

/**
 * @author yyt
 * @date 2021å¹´12æœˆ21æ—¥ 19:30
 */
public class DownloadImgPipeline implements Pipeline {
    /**
     * å›¾ç‰‡ä¿å­˜çš„è·¯å¾„
     */
    private static final String BASE_IMG_FILE_PATH = &quot;D:&quot; + File.separator + &quot;Desktop&quot; + File.separator + &quot;MZT&quot; + File.separator;

    @Override
    public void process(ResultItems resultItems, Task task) {
        MztImage newImage = resultItems.get(&quot;result&quot;);
        if(newImage != null){
            // æ ¹æ®æ ‡é¢˜åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶
            String dirStr = BASE_IMG_FILE_PATH + newImage.getName() + &quot;.txt&quot;;
            File file = new File(dirStr);
            if (!file.getParentFile().exists()){
                // åŒ…å«çˆ¶æ–‡ä»¶å¤¹
                file.getParentFile().mkdirs();
            }
            // æ ¹æ®é“¾æ¥ä¸‹è½½å›¾ç‰‡
            String imageUrl = newImage.getAvatar();
            // è·å–å›¾ç‰‡çš„æ–‡ä»¶å
            // String fileName = imageUrl.substring(imageUrl.lastIndexOf(&quot;/&quot;) + 1);
            try {
                // ä¸‹è½½å›¾ç‰‡
                // HttpFileTool.download(imageUrl, dirStr + imageUrl);
                Writer writer = new FileWriter(file, true);
                writer.write(imageUrl + &quot;\r\n&quot;);
                writer.flush();
                writer.close();
            } catch (Exception e) {
                e.printStackTrace();
                System.out.println(&quot;DownloadImgPipeline è¿è¡Œå‡ºç°å¼‚å¸¸...&quot;);
            }
        }
    }
}
</code></pre>
<h3 id="debug">Debug</h3>
<p>å› ä¸ºä¸‹è½½ä¿å­˜å›¾ç‰‡ä¼šå‡ºç° <code>403</code> é”™è¯¯ï¼Œæ‰€ä»¥æ”¹ä¸ºä¿å­˜å›¾ç‰‡çš„é“¾æ¥ã€‚</p>
<pre><code>java.io.IOException: Server returned HTTP response code: 403 for URL: https://p.iimzt.com/2021/12/20b01c.jpg
</code></pre>
<p>æŸ¥çœ‹äº†ä¸€ä¸‹ç½‘é¡µå…ƒç´ ï¼Œä¸å‡ºæ„å¤–åº”è¯¥æ˜¯â€œåŒæºç­–ç•¥â€å¯¼è‡´çš„â€”â€”<code>&lt;img&gt;</code> æ ‡ç­¾ä¸­è®¾ç½®äº†ç‹¬ç«‹çš„è¯·æ±‚ç­–ç•¥ <code>referrerpolicy=&quot;origin&quot;</code>ã€‚è€Œ WebMagic ä¹Ÿæœ‰å¯¹åº”çš„æ–¹æ¡ˆï¼šé€šè¿‡è®¾ç½® Site å¯¹è±¡æ¥è¿›è¡Œé…ç½®ç¼–ç ã€HTTP å¤´ã€è¶…æ—¶æ—¶é—´ã€é‡è¯•ç­–ç•¥ç­‰ã€ä»£ç†ç­‰ä¿¡æ¯ï¼Œé‚£å¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>Fiddler</code> æŠ“åŒ…ï¼Œå†ä½¿ç”¨ <code>addHeader(String, String)</code> æ–¹æ³•å’Œ <code>addCookie(String, String)</code> æ–¹æ³•ä¼ªè£…ã€‚<br>
ä½†ç»è¿‡æµ‹è¯•ï¼Œä¾ç„¶ä¸è¡Œï¼ˆæˆ‘å¤ªèœäº†ï¼‰ã€‚ğŸ˜«</p>
<h3 id="çˆ¬å–ç»“æœ">çˆ¬å–ç»“æœ</h3>
<p>å¼€å§‹æ¼«é•¿çš„ç­‰å¾…ã€‚â³â³â³<br>
<img src="https://mytc2020-1300758689.cos.ap-guangzhou.myqcloud.com/Gridea/WebMagicDownload.png" alt="è¿è¡Œå®Œæ¯•" loading="lazy"><br>
æ‰“å¼€æ–‡ä»¶å¤¹ä¸€çœ‹ï¼Œçˆ¬å–æˆåŠŸäº†ï¼ï¼ï¼ğŸ‰ğŸ‰ğŸ‰<br>
<img src="https://mytc2020-1300758689.cos.ap-guangzhou.myqcloud.com/Gridea/DownloadRes.png" alt="ä¿å­˜ç»“æœ" loading="lazy"></p>

        </div>
        <!-- Share to Twitter, Weibo, Telegram -->
        <div class="flex items-center">
          <div class="mr-4 flex items-center">
            <i class="ri-share-forward-line text-gray-500"></i>
          </div>
          <div class="px-4 cursor-pointer text-blue-500 hover:bg-blue-100 dark:hover:bg-gray-600 inline-flex" @click="shareToTwitter">
            <i class="ri-twitter-line"></i>
          </div>
          <div class="px-4 cursor-pointer text-red-500 hover:bg-red-100 dark:hover:bg-gray-600 inline-flex" @click="shareToWeibo">
            <i class="ri-weibo-line"></i>
          </div>
          <div class="px-4 cursor-pointer text-indigo-500 hover:bg-indigo-100 dark:hover:bg-gray-600 inline-flex" @click="shareToTelegram">
            <i class="ri-telegram-line"></i>
          </div>
        </div>
      </div>

      

      
        <div id="vlaine-comment"></div>
      

      <footer class="py-12 text-center px-4 md:px-0" v-pre>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
</footer>
    </div>

    <!-- TOC Container -->
    <div class="fixed right-0 bottom-0 mb-16 mr-4 shadow w-8 h-8 rounded-full flex justify-center items-center z-10 cursor-pointer bg-white dark:bg-gray-500 dark:text-gray-200 hover:shadow-lg transition-all animated fadeInRight" @click="showToc = true">
      <i class="ri-file-list-line"></i>
    </div>

    <div class="fixed right-0 top-0 bottom-0 overflow-y-auto w-64 bg-white dark:bg-gray-800 p-4 border-l border-gray-100 dark:border-gray-600 z-10 transition-fast" :class="{ '-mr-64': !showToc }">
      <div class="flex mb-4 justify-end">
        <div class="w-8 h-8 inline-flex justify-center items-center rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 transition-fast" @click="showToc = false">
          <i class="ri-close-line text-lg"></i>
        </div>
      </div>
      <div class="post-toc-container">
        <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E5%89%8D%E8%A8%80">å‰è¨€</a></li>
<li><a href="#%E6%8F%92%E4%BB%B6-%E5%9B%BE%E7%89%87%E5%8A%A9%E6%89%8B">æ’ä»¶ â€” å›¾ç‰‡åŠ©æ‰‹</a></li>
<li><a href="#%E6%A1%86%E6%9E%B6-webmagic">æ¡†æ¶ â€” WebMagic</a>
<ul>
<li><a href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96">æ·»åŠ ä¾èµ–</a></li>
<li><a href="#%E7%9B%AE%E6%A0%87%E7%BD%91%E7%AB%99">ç›®æ ‡ç½‘ç«™</a></li>
<li><a href="#%E5%88%86%E6%9E%90%E8%A7%84%E5%BE%8B">åˆ†æè§„å¾‹</a></li>
<li><a href="#%E5%AE%9E%E7%8E%B0-pageprocessor">å®ç° PageProcessor</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89-pipeline">è‡ªå®šä¹‰ Pipeline</a></li>
<li><a href="#debug">Debug</a></li>
<li><a href="#%E7%88%AC%E5%8F%96%E7%BB%93%E6%9E%9C">çˆ¬å–ç»“æœ</a></li>
</ul>
</li>
</ul>
</li>
</ul>

      </div>
    </div>

    <!-- Back to top -->
    <div class="fixed right-0 bottom-0 mb-4 mr-4 shadow w-8 h-8 rounded-full flex justify-center items-center z-10 cursor-pointer bg-white hover:shadow-lg transition-all dark:bg-gray-500 dark:text-gray-200" @click="backToUp" v-show="scrolled">
      <i class="ri-arrow-up-line"></i>
    </div>
  </div>

  <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <!-- Background of PhotoSwipe. 
        It's a separate element as animating opacity is faster than rgba(). -->
  <div class="pswp__bg">
  </div>
  <!-- Slides wrapper with overflow:hidden. -->
  <div class="pswp__scroll-wrap">
    <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
    <div class="pswp__container">
      <div class="pswp__item">
      </div>
      <div class="pswp__item">
      </div>
      <div class="pswp__item">
      </div>
    </div>
    <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
    <div class="pswp__ui pswp__ui--hidden">
      <div class="pswp__top-bar">
        <!--  Controls are self-explanatory. Order can be changed. -->
        <div class="pswp__counter">
        </div>
        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
        <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
        <!-- element will get class pswp__preloader--active when preloader is running -->
        <div class="pswp__preloader">
          <div class="pswp__preloader__icn">
            <div class="pswp__preloader__cut">
              <div class="pswp__preloader__donut">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
        <div class="pswp__share-tooltip">
        </div>
      </div>
      <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
      </button>
      <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
      </button>
      <div class="pswp__caption">
        <div class="pswp__caption__center">
        </div>
      </div>
    </div>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://ACodingDay.github.io/media/scripts/main.js"></script>
  
  <!-- Code Highlight -->
  
    <script src="https://ACodingDay.github.io/media/prism.js"></script>
    <script>
      Prism.highlightAll()
    </script>
  

  <script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>
  <script>
    //æ‹¿åˆ°é¢„è§ˆæ¡†æ¶ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„htmlä»£ç 
    var pswpElement = document.querySelectorAll('.pswp')[0];
    //å®šä¹‰å›¾ç‰‡æ•°ç»„å˜é‡
    var imgitems;
    /**
    * ç”¨äºæ˜¾ç¤ºé¢„è§ˆç•Œé¢
    * @param index å›¾ç‰‡æ•°ç»„ä¸‹æ ‡
    */
    function viewImg(index) {
      //å…¶å®ƒé€‰é¡¹è¿™é‡Œä¸åšè¿‡å¤šé˜è¿°ï¼Œè¯¦æƒ…è§å®˜ç½‘
      var pswpoptions = {
        index: parseInt(index, 10), // å¼€å§‹å¹»ç¯ç‰‡ç´¢å¼•ã€‚0æ˜¯ç¬¬ä¸€å¼ å¹»ç¯ç‰‡ã€‚å¿…é¡»æ˜¯æ•´æ•°ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ã€‚
        bgOpacity: 0.7, // èƒŒæ™¯é€æ˜åº¦ï¼Œ0-1
        maxSpreadZoom: 3, // ç¼©æ”¾çº§åˆ«ï¼Œä¸è¦å¤ªå¤§
      };
      //åˆå§‹åŒ–å¹¶æ‰“å¼€PhotoSwipeï¼ŒpswpElementå¯¹åº”ä¸Šé¢é¢„è§ˆæ¡†æ¶ï¼ŒPhotoSwipeUI_Defaultä¸ºçš®è‚¤ï¼Œimgitemsä¸ºå›¾ç‰‡æ•°ç»„ï¼Œpswpoptionsä¸ºé€‰é¡¹
      var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, imgitems, pswpoptions);
      gallery.init()
    }
    /**
    * ç”¨äºæ·»åŠ å›¾ç‰‡ç‚¹å‡»äº‹ä»¶
    * @param img å›¾ç‰‡å…ƒç´ 
    * @param index æ‰€å±ä¸‹æ ‡ï¼ˆåœ¨imgitemsä¸­çš„ä½ç½®ï¼‰
    */
    function addImgClick(img, index) {
      img.onclick = function() {
        viewImg(index)
      }
    }
    /**
    * è½®è¯¢æ‰€æœ‰å›¾ç‰‡ï¼Œè·å–srcã€widthã€heightç­‰æ•°æ®ï¼ŒåŠ å…¥imgitemsï¼Œå¹¶ç»™å›¾ç‰‡å…ƒç´ æ·»åŠ äº‹ä»¶
    * æœ€å¥½åœ¨onloadä¸­æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œæœ¬ç«™å› æ”¾åœ¨æœ€åº•éƒ¨ï¼Œæ‰€ä»¥ç›´æ¥åˆå§‹åŒ–
    * å¼‚æ­¥åŠ è½½å›¾ç‰‡å¯åœ¨å›¾ç‰‡å…ƒç´ åˆ›å»ºå®Œæˆåè°ƒç”¨æ­¤æ–¹æ³•
    */
    function initImg() {
      //é‡ç½®å›¾ç‰‡æ•°ç»„
      imgitems = [];
      //æŸ¥æ‰¾class:markdown ä¸‹çš„æ‰€æœ‰imgå…ƒç´ å¹¶éå†
      var imgs = document.querySelectorAll('.markdown img');
      for (var i = 0; i < imgs.length; i++) {
        var img = imgs[i];
        //æœ¬ç«™ç›¸å†Œåˆå§‹ä¸ºloadingå›¾ç‰‡ï¼ŒçœŸå®å›¾ç‰‡æ”¾åœ¨data-src
        var ds = img.getAttribute("data-src");
        //åˆ›å»ºimageå¯¹è±¡ï¼Œç”¨äºè·å–å›¾ç‰‡å®½é«˜
        var imgtemp = new Image();
        //åˆ¤æ–­æ˜¯å¦å­˜åœ¨data-src
        if (ds != null && ds.length > 0) {
          imgtemp.src = ds
        } else {
          imgtemp.src = img.src
        }
        //åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç¼“å­˜
        if (imgtemp.complete) {
          var imgobj = {
            "src": imgtemp.src,
            "w": imgtemp.width,
            "h": imgtemp.height,
          };
          imgitems[i] = imgobj;
          addImgClick(img, i);
        } else {
          console.log('è¿›æ¥äº†2')
          imgtemp.index = i;
          imgtemp.img = img;
          imgtemp.onload = function() {
            var imgobj = {
              "src": this.src,
              "w": this.width,
              "h": this.height,
            };
            //ä¸è¦ä½¿ç”¨pushï¼Œå› ä¸ºonloadå‰åé¡ºåºä¼šä¸åŒ
            imgitems[this.index] = imgobj
            //æ·»åŠ ç‚¹å‡»äº‹ä»¶
            addImgClick(this.img, this.index);
          }
        }
      }
    }
    //åˆå§‹åŒ–
    initImg();
  </script>
  
    <script type="application/javascript" src="https://unpkg.com/valine"></script>
<script type="application/javascript">
  new Valine({
    el: '#vlaine-comment',
    appId: 'bD8hSVDLDm7muV7Wj9JU43dW-gzGzoHsz',
    appKey: 'x1T4YaSJCqVxlSDzxkELHKwd',
    pageSize: 10,
    notify: false,
    avatar: 'mp',
    verify: true,
    placeholder: 'æ¥éƒ½æ¥äº†ï¼Œä¸å¦¨è¯„è®ºä¸€ä¸‹',
    visitor: true,
    highlight: true,
    recordIP: true,
  })
</script>
  
  
</body>

</html>